<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>深入理解JS模块 | 迪诺笔记</title>
    <meta name="description" content="哪里会有人喜欢孤独，不过是不喜欢失望罢了。    ——村上春树">
    <meta name="generator" content="VuePress 1.4.0">
    <script src="https://hm.baidu.com/hm.js?6d4a99079a9531464d70b917d3d7449d"></script>
  <link rel="icon" href="/logo.png">
  <link rel="manifest" href="/manifest.json">
  <meta name="keywords" content="前端博客,开发经验,前端进阶,源码分析,读书笔记,JohnieXu">
  <meta name="theme-color" content="#FAD95C">
  <meta name="apple-touch-fullscreen" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
  <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#FAD95C">
  <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
  <meta name="google-site-verification" content="VJDAfmKkQi_fst1HyzcNY4ifwP5w7EhLCXjjO8qgXqM">
  <meta name="baidu-site-verification" content="8xYgZOGSrO">
    
    <link rel="preload" href="/assets/css/0.styles.d1382f8f.css" as="style"><link rel="preload" href="/assets/js/app.85d3a545.js" as="script"><link rel="preload" href="/assets/js/2.b254d7e2.js" as="script"><link rel="preload" href="/assets/js/21.bc9fcd03.js" as="script"><link rel="preload" href="/assets/js/5.0d081646.js" as="script"><link rel="prefetch" href="/assets/js/10.ad70465e.js"><link rel="prefetch" href="/assets/js/11.3cc2a891.js"><link rel="prefetch" href="/assets/js/12.db8a362d.js"><link rel="prefetch" href="/assets/js/13.57e754ce.js"><link rel="prefetch" href="/assets/js/14.398c18fd.js"><link rel="prefetch" href="/assets/js/15.fa7c32b5.js"><link rel="prefetch" href="/assets/js/16.88fe60a2.js"><link rel="prefetch" href="/assets/js/17.a3773dec.js"><link rel="prefetch" href="/assets/js/18.5360b253.js"><link rel="prefetch" href="/assets/js/19.77f7a06d.js"><link rel="prefetch" href="/assets/js/20.e4ed87ed.js"><link rel="prefetch" href="/assets/js/22.27e4da0b.js"><link rel="prefetch" href="/assets/js/23.bc4033eb.js"><link rel="prefetch" href="/assets/js/24.3988056a.js"><link rel="prefetch" href="/assets/js/25.c2ace688.js"><link rel="prefetch" href="/assets/js/26.b669e297.js"><link rel="prefetch" href="/assets/js/27.856e0ae2.js"><link rel="prefetch" href="/assets/js/28.0185934a.js"><link rel="prefetch" href="/assets/js/29.1f2814b1.js"><link rel="prefetch" href="/assets/js/3.8d498305.js"><link rel="prefetch" href="/assets/js/30.59587f93.js"><link rel="prefetch" href="/assets/js/31.352127f2.js"><link rel="prefetch" href="/assets/js/32.0ea09050.js"><link rel="prefetch" href="/assets/js/33.3a0b6ad1.js"><link rel="prefetch" href="/assets/js/34.4a0e0a07.js"><link rel="prefetch" href="/assets/js/35.306db045.js"><link rel="prefetch" href="/assets/js/36.fbb4c7f4.js"><link rel="prefetch" href="/assets/js/37.cdfb47c4.js"><link rel="prefetch" href="/assets/js/38.db82b913.js"><link rel="prefetch" href="/assets/js/4.deba05c5.js"><link rel="prefetch" href="/assets/js/6.116a5ed5.js"><link rel="prefetch" href="/assets/js/7.d93de520.js"><link rel="prefetch" href="/assets/js/8.f3f91096.js"><link rel="prefetch" href="/assets/js/9.95e567bd.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d1382f8f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">迪诺笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="文章专栏" class="dropdown-title"><span class="title">文章专栏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/articles/FE/" class="nav-link router-link-active">
  硬核前端
</a></li><li class="dropdown-item"><!----> <a href="/articles/GO/" class="nav-link">
  GO笔记
</a></li><li class="dropdown-item"><!----> <a href="/articles/UI/" class="nav-link">
  UI设计
</a></li></ul></div></div><div class="nav-item"><a href="/articles/PRACTICE/" class="nav-link">
  实战分享
</a></div><div class="nav-item"><a href="https://www.yuque.com/johniexu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  语雀
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://juejin.im/user/59eb44426fb9a045000230b8" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/JohnieXu/xx-blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="文章专栏" class="dropdown-title"><span class="title">文章专栏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/articles/FE/" class="nav-link router-link-active">
  硬核前端
</a></li><li class="dropdown-item"><!----> <a href="/articles/GO/" class="nav-link">
  GO笔记
</a></li><li class="dropdown-item"><!----> <a href="/articles/UI/" class="nav-link">
  UI设计
</a></li></ul></div></div><div class="nav-item"><a href="/articles/PRACTICE/" class="nav-link">
  实战分享
</a></div><div class="nav-item"><a href="https://www.yuque.com/johniexu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  语雀
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://juejin.im/user/59eb44426fb9a045000230b8" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/JohnieXu/xx-blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/articles/FE/regular-directives-of-Git.html" class="sidebar-link">Git常用命令整理</a></li><li><a href="/articles/FE/FE-file-upload.html" class="sidebar-link">前端文件上传总结</a></li><li><a href="/articles/FE/deep-understanding-of-JS-module.html" class="active sidebar-link">深入理解JS模块</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/articles/FE/deep-understanding-of-JS-module.html#引言" class="sidebar-link">引言</a></li><li class="sidebar-sub-header"><a href="/articles/FE/deep-understanding-of-JS-module.html#类模块化" class="sidebar-link">类模块化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/articles/FE/deep-understanding-of-JS-module.html#函数封装" class="sidebar-link">函数封装</a></li><li class="sidebar-sub-header"><a href="/articles/FE/deep-understanding-of-JS-module.html#对象" class="sidebar-link">对象</a></li><li class="sidebar-sub-header"><a href="/articles/FE/deep-understanding-of-JS-module.html#立即执行函数" class="sidebar-link">立即执行函数</a></li></ul></li><li class="sidebar-sub-header"><a href="/articles/FE/deep-understanding-of-JS-module.html#commonjs-nodejs" class="sidebar-link">CommonJS(NodeJS)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/articles/FE/deep-understanding-of-JS-module.html#commonjs模块存在的问题" class="sidebar-link">CommonJS模块存在的问题</a></li></ul></li><li class="sidebar-sub-header"><a href="/articles/FE/deep-understanding-of-JS-module.html#amd-requirejs" class="sidebar-link">AMD(RequireJS)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/articles/FE/deep-understanding-of-JS-module.html#总结" class="sidebar-link">总结</a></li><li class="sidebar-sub-header"><a href="/articles/FE/deep-understanding-of-JS-module.html#amd与cmd的区别" class="sidebar-link">AMD与CMD的区别</a></li></ul></li><li class="sidebar-sub-header"><a href="/articles/FE/deep-understanding-of-JS-module.html#cmd-seajs" class="sidebar-link">CMD(SeaJS)</a></li><li class="sidebar-sub-header"><a href="/articles/FE/deep-understanding-of-JS-module.html#umd" class="sidebar-link">UMD</a></li><li class="sidebar-sub-header"><a href="/articles/FE/deep-understanding-of-JS-module.html#es6模块-import-export" class="sidebar-link">ES6模块(import,export)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/articles/FE/deep-understanding-of-JS-module.html#注意" class="sidebar-link">注意</a></li></ul></li><li class="sidebar-sub-header"><a href="/articles/FE/deep-understanding-of-JS-module.html#参考文章" class="sidebar-link">参考文章</a></li></ul></li><li><a href="/articles/FE/prototype-of-JS.html" class="sidebar-link">JS原型链</a></li><li><a href="/articles/FE/deep-understanding-of-es6-module.html" class="sidebar-link">ES6模块的核心知识点</a></li><li><a href="/articles/FE/key-concepts-of-react-and-dva.html" class="sidebar-link">Ract和Dva的一些核心概念</a></li><li><a href="/articles/FE/video.js-in-react.html" class="sidebar-link">React中使用Video.js</a></li><li><a href="/articles/FE/react-quill-in-react.html" class="sidebar-link">React中使用Quill.js</a></li><li><a href="/articles/FE/react-component-encapsulation.html" class="sidebar-link">React封装通用组件</a></li><li><a href="/articles/FE/frontend-interview.html" class="sidebar-link">frontend-interview</a></li><li><a href="/articles/FE/Talk-about-the-pit-encountered-in-the-implementation-of-Vue-routing-component-cache.html" class="sidebar-link">聊一聊实现Vue路由组件缓存遇到的’坑‘</a></li><li><a href="/articles/FE/Take-you-to-analyze-the-source-code-of-Vue-router.html" class="sidebar-link">带你全面分析vue-router源码（万字长文）</a></li><li><a href="/articles/FE/Thoroughly-understand-DOM-event-mechanism.html" class="sidebar-link">这次一定彻底弄懂DOM事件机制</a></li><li><a href="/articles/FE/A-comprehensive-analysis-and-summary-of-BFC-principle-and-Practice.html" class="sidebar-link">全面分析总结BFC原理及实践</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="引言"><a href="#引言" class="header-anchor">#</a> 引言</h2> <p><code>JavaScript</code>的模块机制其实是借鉴的其他程序设计语言的, 如Java中package的概念, <code>import java.util.ArrayList;</code>; package就是逻辑上相关的代码组织到同一个包内，包内是一个相对独立的作用域，不用担心命名冲突等等, 当需要在外部使用的时候直接import相应的package即可。</p> <p>由于<code>JavaScript</code>在设计之初的定位原因, 并没有提供类似模块的功能, 随后便出现了各种<strong>模拟</strong>类似功能的规范。到今天(2018-5-28)ES6已经十分普及, ES6的模块机制已经大规模使用, 我们完全可以使用ES6提供的模块化规范(机制)。</p> <h2 id="类模块化"><a href="#类模块化" class="header-anchor">#</a> 类模块化</h2> <p><strong>类模块化</strong>: 这是我自己理解的一个模块化概念, 指的是像<strong>函数封装</strong>, <strong>对象</strong>, <strong>立即执行函数包装</strong>这样的类似模块化的规范。</p> <h3 id="函数封装"><a href="#函数封装" class="header-anchor">#</a> 函数封装</h3> <p>函数就是对实现特定逻辑的一组语句的打包, JS的作用域也是基于函数的, 所以函数可以很自然的作为模块化, 这也是最开始实现模块化的一种方法。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">func1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>引用模块也即是调用函数, 这种函数定义的方式是直接采用<code>script</code>来加载执行的(不经过模块打包器处理), 故函数是挂载在全局<code>window</code>对象上, 因此<strong>存在污染全局变量的缺点和变量冲突等缺点</strong>。</p> <h3 id="对象"><a href="#对象" class="header-anchor">#</a> 对象</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> myModule <span class="token operator">=</span> <span class="token punctuation">{</span>
    var1<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    var2<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token function-variable function">func1</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token operator">...</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">func2</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token operator">...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>将上面的函数封装在一个对象中, 引用模块即引用相应文件中对象上的属性, 如: <code>myModule.func1()</code>, 通过对象名(模块名)避免了全局变量污染, 但是存在安全问题, 如: 外部可以随意修改模块内部的属性和方法等。</p> <h3 id="立即执行函数"><a href="#立即执行函数" class="header-anchor">#</a> 立即执行函数</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> myModule <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> var1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> var2 <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">func1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token operator">...</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token operator">...</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        func1<span class="token operator">:</span> func1<span class="token punctuation">,</span>
        func2<span class="token operator">:</span> func2
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在上面对象的基础之上, 用立即执行函数进行封装, 可以解决全局变量污染, 防止模块内部属性和方法被外部修改, 这是当前主流模块规范的基础。</p> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>这里的随意修改指的是：可以通过<code>myModule.func1 = 'abc'</code>等赋值方式来修改掉模块的属性、变量等指向</p></div> <h2 id="commonjs-nodejs"><a href="#commonjs-nodejs" class="header-anchor">#</a> CommonJS(NodeJS)</h2> <p><strong>CommonJS</strong>: 通用模块规范, 主要由NodeJS具体实现; 根据CommonJS规范, 一个单独的文件就是一个模块。每一个模块都是一个单独的作用域, 也就是说, <strong>在该模块内部定义的变量无法被其他模块读取</strong>, 除非定义为global(浏览器中为window)对象的属性。</p> <p>CommonJS模块例子:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 模块定义 myModule.js</span>
<span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'myName'</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">printName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">printFullName</span><span class="token punctuation">(</span><span class="token parameter">firstName</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>firstName <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    printName<span class="token operator">:</span> printName<span class="token punctuation">,</span>
    printFullName<span class="token operator">:</span> printFullName
<span class="token punctuation">}</span>
<span class="token comment">// 加载模块</span>
<span class="token keyword">var</span> myModule <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./myModule.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
myModule<span class="token punctuation">.</span><span class="token function">printName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="commonjs模块存在的问题"><a href="#commonjs模块存在的问题" class="header-anchor">#</a> CommonJS模块存在的问题</h3> <p>require引入模块是同步的, 由于在浏览器环境下, JS都是通过script标签引入, 而这是天生异步的, 因此<code>CommonJS</code>在浏览器环境下无法正常加载(无法处理依赖问题)。NodeJS广泛采用CommonJS的原因主要是NodeJS的require模块都是在本地, 完全不用担心异步过程(即使在服务器上也是如此)。因此, 针对浏览器端异步require模块出现了<code>AMD</code>和<code>CMD</code>规范。</p> <h2 id="amd-requirejs"><a href="#amd-requirejs" class="header-anchor">#</a> AMD(RequireJS)</h2> <p><strong>AMD</strong>: Asynchronous Module Definition(异步模块定义), 在浏览器端模块化开发的规范, 不是JavaScript原生支持, RequireJS是AMD规范的具体实现(严格上说是<strong>RequireJS的推广中产生的AMD规范</strong>)。</p> <p>RequireJS模块例子:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 定义模块 myModule.js</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'myModule'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'dependency'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'myName'</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">printName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        printName<span class="token operator">:</span> printName
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 加载模块</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'myModule'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">my</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
　 my<span class="token punctuation">.</span><span class="token function">printName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>RequireJS定义了一个全局函数<code>define(id?, dependencies?, factory);</code>来创建一个模块。
<code>AMD</code>模块中所有的依赖都前置, 其模块是异步的, 该自定义的模块内用到的模块均等到异步加载完成之后才调用响应模块, 这样浏览器不会失去响应。require指定的回调函数，只有前面的模块都加载成功后，才会运行，解决了依赖性的问题。</p> <p>例如: 现需要在一个HTML页面中需要使用jQuery-fileupload插件, 并通过script标签的方式引入JS文件, 传统的方式是<strong>先引入jquery.min.js再引入jquery.fileupload.js</strong>。由于jqery.fileupload.js是基于jQuery的, 必须保证首先引入jQuery, 加载JS时候页面会停止若此时网络较差, 会导致页面失去响应时间较长。</p> <h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <p><strong>RequireJS主要解决如问题:</strong></p> <ol><li>多个JS文件可能有依赖关系，被依赖的文件需要早于依赖它的文件加载到浏览器;</li> <li>JS加载的时候浏览器会停止页面渲染，加载文件越多，页面失去响应时间越长。</li></ol> <p><strong>模块机制用途:</strong></p> <ol><li><code>CommonJS</code>是同步的, 主要用于服务器</li> <li><code>AMD</code>和<code>CMD</code>是异步的, 两者的模块定义和加载机制稍有不同, 主要用于浏览器</li></ol> <h3 id="amd与cmd的区别"><a href="#amd与cmd的区别" class="header-anchor">#</a> AMD与CMD的区别</h3> <ol><li><code>AMD</code>推崇依赖前置，在定义模块的时候就要声明其依赖的模块<code>,</code>CMD`推崇就近依赖，只有在用到某个模块的时候再去require</li> <li>两个都是定义的全局define函数来定义模块, define接收函数function(require, exports, module)保持一致</li> <li><code>CMD</code>是懒加载, 仅在require时才会加载模块; <code>AMD</code>是预加载, 在定义模块时就提前加载好所有依赖</li> <li><code>CMD</code>保留了CommonJS风格</li></ol> <h2 id="cmd-seajs"><a href="#cmd-seajs" class="header-anchor">#</a> CMD(SeaJS)</h2> <p><strong>CMD</strong>: Common Module Definition通用模块定义, 由国内发展出来, SeaJS是其典型代表, 即SeaJS是通过浏览器对CMD的具体实现</p> <p>SeaJS模块例子:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 定义模块  myModule.js</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">require<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> $ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'jquery.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> out <span class="token operator">=</span> foo<span class="token punctuation">.</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addClass</span><span class="token punctuation">(</span><span class="token string">'active'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> out<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 加载模块</span>
seajs<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'myModule.js'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">my</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>SeaJS定义了一个全局函数<code>define(id?, deps?, factory)</code>来创建一个模块, define接受一个需要三个参数的函数, 分别为:</p> <ul><li><strong>require</strong>: 一个方法, 接受模块标识 作为唯一参数，用来获取其他模块提供的接口：require(id)</li> <li><strong>exports</strong>: 一个对象, 用来向外提供模块接口</li> <li><strong>module</strong>: 一个对象, 上面存储了与当前模块相关联的一些属性和方法</li></ul> <p>CMD推崇依赖就近原则(也就是<strong>懒加载</strong>), 模块内部的依赖在需要引入的时候再引入, 如上例中的<code>var $ = require('jquery.js')</code>, 这一点和通用的<code>CommonJS</code>模块风格保持一致。</p> <h2 id="umd"><a href="#umd" class="header-anchor">#</a> UMD</h2> <p><strong>UMD</strong>: 是一个既能在<code>seajs（CMD）</code>环境里引入，又能在<code>requirejs（AMD）</code>环境中引入，
当然也能在<code>Node.js（CommonJS）</code>中使用，另外还可以在没有模块化的环境中用<code>script标签</code>全局引入的'模块规范'</p> <p><code>UMD</code>模块其实就是在当前JS执行环境中对以上几种模块规范定义的<code>define</code>, <code>module.exports</code>等进行判断, 同一模块根据不同场所返回不同结果。</p> <p>UMD模块例子:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">global</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">factory</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 具体业务方模块的定义</span>
        <span class="token keyword">var</span> moduleName <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> moduleName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> module <span class="token operator">!==</span> <span class="token string">'undefined'</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> exports <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> define <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>define<span class="token punctuation">.</span>cmd <span class="token operator">||</span> define<span class="token punctuation">.</span>amd<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">define</span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        global<span class="token punctuation">.</span>moduleName <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> window <span class="token operator">!==</span> <span class="token string">'undefined'</span> <span class="token operator">?</span> window <span class="token operator">:</span> global<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>UMD模块在不同环境引入:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// RequireJs</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'moduleName'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'otherModule'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">moduleName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>moduleName<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// SeaJs</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">require<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> myModule <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'moduleName'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Node.js</span>
<span class="token keyword">var</span> myModule <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'moduleName'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Browser global</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;moduleName.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">&quot;text/javascript&quot;</span><span class="token operator">&gt;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>moduleName<span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><h2 id="es6模块-import-export"><a href="#es6模块-import-export" class="header-anchor">#</a> ES6模块(import,export)</h2> <p>ES6在语言标准的层面上, 实现了模块功能, 而且实现得相当简单, 完全可以取代<code>CommonJS</code>和<code>AMD</code>规范, 是浏览器和服务器通用的模块解决方案。</p> <p>ES6模块例子:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 模块定义 myModule.js</span>
<span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">'myName'</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">printName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">printFullName</span><span class="token punctuation">(</span><span class="token parameter">firstName</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>firstName <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> myModule <span class="token operator">=</span> <span class="token punctuation">{</span>
    printName<span class="token operator">:</span> printName<span class="token punctuation">,</span>
    printFullName<span class="token operator">:</span> printFullName
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> myModule<span class="token punctuation">;</span>

<span class="token comment">// 加载模块</span>
<span class="token keyword">import</span> myModule<span class="token punctuation">,</span> <span class="token punctuation">{</span> printFullName <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./myModule.js'</span><span class="token punctuation">;</span>
myModule<span class="token punctuation">.</span><span class="token function">printName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">printFullName</span><span class="token punctuation">(</span><span class="token string">'myFullName'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="注意"><a href="#注意" class="header-anchor">#</a> 注意</h3> <ol><li>ES6中的<code>export</code>是ES6对于JS模块的一种新的规范, 不同于<code>CommonJS</code>规范中的<code>module.exports</code>和<code>exports</code>;</li> <li><code>CommonJS</code>规范中<code>exports</code>可以理解为指向<code>module.exports</code>的一个指针, 可以<code>exports.newModule = {...}</code>, 但是这样写<code>exports={..}</code>是不行的, 这会将<code>exports</code>这个指针指向新的<code>{...}</code>对象, 不再指向<code>module.exports</code>;</li> <li>ES6语法一般都经过<code>babel</code>转义为JS, 故可以在ES6中使用<code>CommonJS</code>模块规范, 如: <code>var myModule = require('./myModule.js')</code>。</li></ol> <h2 id="参考文章"><a href="#参考文章" class="header-anchor">#</a> 参考文章</h2> <ol><li><a href="https://www.cnblogs.com/chenguangliang/p/5856701.html" target="_blank" rel="noopener noreferrer">js模块化编程之彻底弄懂CommonJS和AMD/CMD<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.cnblogs.com/brandonchen/p/5550470.html" target="_blank" rel="noopener noreferrer">写一个适应所有环境的js模块<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.zhangxinxu.com/sp/seajs/" target="_blank" rel="noopener noreferrer">SeaJS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://requirejs.org/" target="_blank" rel="noopener noreferrer">RequireJS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://es6.ruanyifeng.com/#docs/module" target="_blank" rel="noopener noreferrer">阮一峰-ES6模块<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ol></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/JohnieXu/xx-blog/edit/master/docs/articles/FE/deep-understanding-of-JS-module.md" target="_blank" rel="noopener noreferrer">发现问题？</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">更新于:</span> <span class="time">3/7/2020, 1:31:08 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/articles/FE/FE-file-upload.html" class="prev">
        前端文件上传总结
      </a></span> <span class="next"><a href="/articles/FE/prototype-of-JS.html">
        JS原型链
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.85d3a545.js" defer></script><script src="/assets/js/2.b254d7e2.js" defer></script><script src="/assets/js/21.bc9fcd03.js" defer></script><script src="/assets/js/5.0d081646.js" defer></script>
  </body>
</html>
